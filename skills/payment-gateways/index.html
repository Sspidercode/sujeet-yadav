<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Skill - Payment Gateways | Sujeet Yadav</title>
    <meta name="description" content="Payment Gateways skill details, intro and comprehensive concepts with examples" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <!-- Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />
    <link href="../../assets/css/style.css" rel="stylesheet" />
    <style>
      .concept-section { margin-bottom: 2rem; }
      .code-example { background: #0b0d12; border: 1px solid rgba(255,255,255,0.08); border-radius: 6px; padding: 12px; white-space: pre; overflow: auto; font-size: 0.875rem; }
      .explanation { margin-bottom: 1rem; }
    </style>
  </head>
  <body class="theme-dark">
    <canvas id="smokeCanvas"></canvas>
    <nav class="navbar navbar-dark nav-v2" style="position: sticky; top: 0; z-index: 10;">
      <div class="container py-2">
        <a class="navbar-brand fw-bold brand-v2 signature-font" href="../../index.html#skills"><img class="brand-logo" src="../../assets/image/sujeet.png" alt="Sujeet Yadav" /></a>
        <a class="btn btn-outline-v2 btn-sm" href="../../index.html#skills">Back to Skills</a>
      </div>
    </nav>
    <main class="section pt-6">
      <div class="container">
        <p class="eyebrow-v2">Skill</p>
        <h1 class="title-v2 mb-2">Payment Gateways</h1>
        <p class="text-muted-2 small mb-4">Integrations with Stripe/Razorpay/PayPal, webhooks, refunds, subscriptions, and PCI best practices. Below is a comprehensive guide to key payment gateway concepts with detailed explanations and examples. (Examples use PHP/Laravel and Node.js; adapt to your stack.)</p>
        
        <div class="row g-4 align-items-start">
          <div class="col-lg-4 text-center">
            <img src="icon.svg" alt="Payment icon" style="width:220px;height:220px;"/>
          </div>
          <div class="col-lg-8">
            <!-- Basic Example -->
            <div class="panel-v2 concept-section">
              <h5 class="mb-2">Basic Example: Payment Initiation</h5>
              <div class="explanation">
                <p>This REST endpoint simulates initiating a payment request, typically handled by a gateway SDK.</p>
              </div>
              <pre class="code-example"><code>POST /payments -d { "amount": 1000, "currency": "INR" }</code></pre>
              <a href="example.txt" class="btn btn-outline-v2 btn-sm mt-2" target="_blank">Open example.txt</a>
            </div>
          </div>
        </div>
        <div class="row g-4 align-items-center">
                      <!-- Concept 1: Overview of Payment Gateways -->
                      <div class="panel-v2 concept-section">
                        <h5 class="mb-2">1. Overview of Payment Gateways</h5>
                        <div class="explanation">
                          <p>Payment gateways process transactions securely between merchants and banks. Key players: Stripe (global, developer-friendly), Razorpay (India-focused), PayPal (e-commerce). Handle auth, capture, and settlement.</p>
                        </div>
                        <pre class="code-example"><code>// General flow
          // 1. Client sends payment intent
          // 2. Gateway creates token/session
          // 3. Confirm payment (3DS if needed)
          // 4. Webhook notifies success/failure
          // 5. Update order status</code></pre>
                      </div>
          
                      <!-- Concept 2: Stripe Integration -->
                      <div class="panel-v2 concept-section">
                        <h5 class="mb-2">2. Stripe Integration</h5>
                        <div class="explanation">
                          <p>Stripe uses Payment Intents API. Install stripe/stripe-php; create intents, handle confirmations. Supports cards, wallets, bank transfers.</p>
                        </div>
                        <pre class="code-example"><code>&lt;?php
          // composer require stripe/stripe-php
          require 'vendor/autoload.php';
          \Stripe\Stripe::setApiKey('sk_test_...');
          
          $intent = \Stripe\PaymentIntent::create([
              'amount' => 1000,  // INR 10.00
              'currency' => 'inr',
              'payment_method_types' => ['card'],
          ]);
          
          echo $intent->client_secret;  // Use in frontend for confirmation
          </code></pre>
                      </div>
          
                      <!-- Concept 3: Razorpay Integration -->
                      <div class="panel-v2 concept-section">
                        <h5 class="mb-2">3. Razorpay Integration</h5>
                        <div class="explanation">
                          <p>Razorpay for INR payments. Use Orders API first, then create payment. Install razorpay/razorpay via Composer; supports UPI, cards, netbanking.</p>
                        </div>
                        <pre class="code-example"><code>&lt;?php
          // composer require razorpay/razorpay
          use Razorpay\Api\Api;
          
          $api = new Api('rzp_test_...', 'your_key_secret');
          
          $order = $api->order->create([
              'receipt' => 'receipt#1',
              'amount' => 10000,  // Paise: INR 100
              'currency' => 'INR'
          ]);
          
          $razorpayOrderId = $order['id'];  // Pass to frontend for payment
          </code></pre>
                      </div>
          
                      <!-- Concept 4: PayPal Integration -->
                      <div class="panel-v2 concept-section">
                        <h5 class="mb-2">4. PayPal Integration</h5>
                        <div class="explanation">
                          <p>PayPal uses REST API for orders. Create order, capture on approval. Install paypal/rest-api-sdk-php; ideal for international e-commerce.</p>
                        </div>
                        <pre class="code-example"><code>&lt;?php
          // Use PayPal SDK
          $config = [
              'mode' => 'sandbox',
              'client_id' => 'your_client_id',
              'client_secret' => 'your_secret'
          ];
          
          $apiContext = new \PayPal\Rest\ApiContext(
              new \PayPal\Auth\OAuthTokenCredential(
                  $config['client_id'],
                  $config['client_secret']
              )
          );
          $apiContext->setConfig($config);
          
          $order = new \PayPal\Api\Order();
          $order->setIntent('CAPTURE')
              ->setPurchaseUnits([
                  new \PayPal\Api\PurchaseUnit([
                      'amount' => [
                          'currency_code' => 'USD',
                          'value' => '10.00'
                      ]
                  ])
              ]);
          
          $order->create($apiContext);  // Returns approval URL
          </code></pre>
                      </div>
          
                      <!-- Concept 5: Webhooks -->
                      <div class="panel-v2 concept-section">
                        <h5 class="mb-2">5. Webhooks</h5>
                        <div class="explanation">
                          <p>Webhooks notify your server of events (payment success, failure). Verify signatures; update DB atomically. Use ngrok for local testing.</p>
                        </div>
                        <pre class="code-example"><code>// Laravel route for Stripe webhook
          Route::post('/webhook/stripe', function (Request $request) {
              $payload = $request->getContent();
              $sigHeader = $request->header('Stripe-Signature');
              $endpointSecret = 'whsec_...';
          
              try {
                  $event = \Stripe\Webhook::constructEvent($payload, $sigHeader, $endpointSecret);
              } catch (Exception $e) {
                  return response('Invalid signature', 400);
              }
          
              if ($event->type === 'payment_intent.succeeded') {
                  $paymentIntent = $event->data->object;
                  // Update order status
                  Order::where('stripe_id', $paymentIntent['id'])->update(['status' => 'paid']);
              }
          
              return response('OK', 200);
          });</code></pre>
                      </div>
          
                      <!-- Concept 6: Refunds and Disputes -->
                      <div class="panel-v2 concept-section">
                        <h5 class="mb-2">6. Refunds and Disputes</h5>
                        <div class="explanation">
                          <p>Process refunds via API (full/partial). Handle disputes with evidence submission. Track via webhooks for dispute.created.</p>
                        </div>
                        <pre class="code-example"><code>// Stripe refund (PHP)
          $refund = \Stripe\Refund::create([
              'payment_intent' => 'pi_...',
              'amount' => 500,  // Partial: INR 5
              'reason' => 'requested_by_customer'
          ]);
          
          // Razorpay refund
          $api->payment->fetch('pay_...')->refund([
              'amount' => 500,  // Paise
              'notes' => ['reason' => 'Duplicate']
          ]);
          
          // Handle dispute webhook
          if ($event->type === 'charge.dispute.created') {
              // Submit evidence
              $dispute = $event->data->object;
              // Upload files, update DB
          }</code></pre>
                      </div>
          
                      <!-- Concept 7: Subscriptions -->
                      <div class="panel-v2 concept-section">
                        <h5 class="mb-2">7. Subscriptions</h5>
                        <div class="explanation">
                          <p>Manage recurring billing with plans, customers. Handle invoice.payment_failed webhooks for retries/cancellations.</p>
                        </div>
                        <pre class="code-example"><code>// Stripe subscription (PHP)
          $customer = \Stripe\Customer::create([
              'email' => 'sujeet@example.com',
              'payment_method' => 'pm_...'
          ]);
          
          $subscription = \Stripe\Subscription::create([
              'customer' => $customer->id,
              'items' => [['price' => 'price_monthly_plan_id']],
              'expand' => ['latest_invoice.payment_intent']
          ]);
          
          // Cancel
          \Stripe\Subscription::update($subscription->id, ['cancel_at_period_end' => true]);
          
          // Webhook for invoice.payment_failed
          if ($event->type === 'invoice.payment_failed') {
              $invoice = $event->data->object;
              // Notify user, retry or downgrade
          }</code></pre>
                      </div>
          
                      <!-- Concept 8: PCI Compliance -->
                      <div class="panel-v2 concept-section">
                        <h5 class="mb-2">8. PCI Compliance</h5>
                        <div class="explanation">
                          <p>PCI DSS ensures card data security. Use tokenization (never store raw cards); SAQ-A for iframes. Gateways handle Level 1 compliance.</p>
                        </div>
                        <pre class="code-example"><code>// Best practices
          // 1. Use gateway iframes/elements (Stripe Elements)
          echo '<script src="https://js.stripe.com/v3/"></script>';
          // Frontend: stripe.elements().create('card');  // Tokenizes
          
          // 2. HTTPS only
          // 3. Validate inputs (no raw CVV storage)
          // 4. Log without sensitive data
          // Laravel: Log::info('Payment attempted', ['amount' => 1000]);  // No card details
          
          // Audit: Regular scans with tools like PCI Wizard</code></pre>
                      </div>
          
                      <!-- Concept 9: Security Best Practices -->
                      <div class="panel-v2 concept-section">
                        <h5 class="mb-2">9. Security Best Practices</h5>
                        <div class="explanation">
                          <p>Verify webhooks, use idempotency keys, rate-limit endpoints. Encrypt sensitive data; monitor for fraud with 3DS.</p>
                        </div>
                        <pre class="code-example"><code>// Idempotency (Stripe)
          $idempotencyKey = uniqid();
          $headers = ['Idempotency-Key' => $idempotencyKey];
          $intent = \Stripe\PaymentIntent::create($params, $headers);
          
          // Rate limiting (Express.js)
          app.use('/payments', rateLimit({ windowMs: 15 * 60 * 1000, max: 100 }));
          
          // Fraud check: Use Radar (Stripe) or custom rules
          if ($order->amount < 100 || $ip->risky()) {
              throw new FraudException();
          }
          
          // 3DS: Enable in intent
          $intent = \Stripe\PaymentIntent::create([
              'amount' => 1000,
              'confirm' => true,
              'use_stripe_sdk' => true  // Triggers 3DS
          ]);</code></pre>
                      </div>
          
                      <!-- Concept 10: Testing and Sandboxes -->
                      <div class="panel-v2 concept-section">
                        <h5 class="mb-2">10. Testing and Sandboxes</h5>
                        <div class="explanation">
                          <p>Use sandbox/test modes with fake cards (e.g., 4242424242424242 for Stripe). Automate with webhooks simulators; test edge cases like failures.</p>
                        </div>
                        <pre class="code-example"><code>// Stripe test cards
          // Success: 4242424242424242, Exp: 12/34, CVC: 123
          // 3DS: 4000000000003220
          // Failure: 4000000000000002
          
          // Sandbox webhook testing (CLI)
          stripe listen --forward-to localhost:8000/webhook
          
          // Unit test (Jest)
          test('processes payment', async () => {
              const response = await request(app)
                  .post('/payments')
                  .send({ amount: 1000, token: 'tok_visa' })
                  .expect(201);
              expect(response.body.status).toBe('succeeded');
          });</code></pre>
                      </div>
          
                      <div class="alert alert-info mt-4">
                        <p>This covers core payment gateway concepts. Always refer to official docs for API updates (e.g., Stripe v2024-11-20). Prioritize security audits and compliance for production.</p>
                      </div>
        </div>
      </div>
    </main>
    <footer class="py-4 small text-center text-muted-2">
      <div class="container">© <span id="year"></span> Sujeet Yadav — All rights reserved.</div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../../assets/js/script.js"></script>
    <script src="../../assets/js/smoke.js"></script>
    <script>
      // Inline script to update year (demo)
      document.getElementById('year').textContent = new Date().getFullYear();
    </script>
  </body>
</html>